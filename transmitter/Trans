#include "PWM.h"
int led = 3;
int pw = 127; //Pulse Width
int32_t frequency = 90000;
bool success;
char serial_data;

void setup() 
{
  Serial.begin(9600);
  // put your setup code here, to run once:
  InitTimersSafe();
  bool success = SetPinFrequencySafe(led, 90000);

  if(success) 
  {
    pinMode(13, OUTPUT);
    digitalWrite(13, HIGH);
  }
  pwmWrite(led, pw);
}

void loop() {
  if(Serial.available() > 0) 
  {
    serial_data = Serial.read();
    send(serial_data);
    Serial.println();
      SetPinFrequency(led, 90000);
  }
}

void send(char character)
{
  for(int i=0; i<8; i++)
  {
    delay(1);
    if((character >> i) & 1)
    {
      SetPinFrequency(led, 93000);
      Serial.print(1);
    }
    else
    {
      SetPinFrequency(led, 87000);
      Serial.print(0);
    }
  }
}
